// This is your Prisma schema file,
    // defining all your database models.

    datasource db {
      provider = "postgresql"
      url      = env("DATABASE_URL")
    }

    generator client {
      provider = "prisma-client-js"
    }

    // User model for email/password auth
    model User {
      id             Int      @id @default(autoincrement())
      email          String   @unique
      username       String
      hashedPassword String
      createdAt      DateTime @default(now())
      role           UserRole @default(USER) //

      // Relations
      enrollments Enrollment[]
      posts       Post[]
      replies     Reply[]
      likes       Like[]
      memePosts   MemePost[]
    }

    // Course model, pre-seeded with KAIST classes
    model Course {
      id         Int      @id @default(autoincrement())
      courseCode String   @unique // e.g., "CS350"
      title      String   // e.g., "Intro to Software Engineering"
      semester   String   // e.g., "Fall 2025"
      createdAt  DateTime @default(now())

      // Relations
      enrollments Enrollment[]
      posts       Post[]
      memePosts   MemePost[]
    }

    // Junction table linking Users and Courses
    model Enrollment {
      id               Int      @id @default(autoincrement())
      userId           Int
      courseId         Int
      isTopContributor Boolean  @default(false)
      createdAt        DateTime @default(now())

      // Relations
      user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
      course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

      @@unique([userId, courseId]) // A user can only enroll once in a course
    }

    // Main forum post model
    model Post {
      id        Int      @id @default(autoincrement())
      content   String   @db.Text
      createdAt DateTime @default(now())

      userId    Int
      courseId  Int

      // Relations
      user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
      course  Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
      replies Reply[]
      likes   Like[]
    }

    // Reply model for posts
    model Reply {
      id        Int      @id @default(autoincrement())
      content   String   @db.Text
      createdAt DateTime @default(now())

      userId    Int
      postId    Int
      parentId  Int?     // <-- New field: ID of the parent reply (nullable)

      // Relations
      user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
      post     Post    @relation(fields: [postId], references: [id], onDelete: Cascade)
      
      // Self-relation for nested replies
      parent   Reply?  @relation("ReplyToReply", fields: [parentId], references: [id], onDelete: Cascade)
      children Reply[] @relation("ReplyToReply")
      
      likes    Like[]
    }

    // Like model for both posts and replies
    model Like {
      id        Int      @id @default(autoincrement())
      createdAt DateTime @default(now())

      userId  Int
      postId  Int? // Nullable, as it could be a reply
      replyId Int? // Nullable, as it could be a post

      // Relations
      user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
      post  Post? @relation(fields: [postId], references: [id], onDelete: Cascade)
      reply Reply? @relation(fields: [replyId], references: [id], onDelete: Cascade)

      // A user can't like the same post/reply twice
      @@unique([userId, postId])
      @@unique([userId, replyId])
    }

    // Special post type for top contributors
    model MemePost {
      id        Int      @id @default(autoincrement())
      imageUrl  String
      createdAt DateTime @default(now())

      userId    Int
      courseId  Int

      // Relations
      user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
      course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
    }

    // --- ADD THIS ENUM AT THE BOTTOM ---
    enum UserRole {
      USER
      ADMIN
    }